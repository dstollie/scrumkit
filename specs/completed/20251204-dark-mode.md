# Product Requirements Document: Dark Mode

## 1. Feature Overzicht

**Feature:** Dark Mode implementatie voor Scrum Toolbox applicatie

**Doel:** Gebruikers de mogelijkheid bieden om te wisselen tussen light en dark mode voor verbeterd visueel comfort en gebruikservaring. Dark mode vermindert oogvermoeidheid bij gebruik in donkere omgevingen en is een standaard verwachting voor moderne webapplicaties.

## 2. Functionele Vereisten

### FV1: Theme Switching Mechanisme

---

**FV1.1: Theme Provider Integratie** [DONE]

Implementeer een theme provider die de gehele applicatie omvat en theme state beheert.

Gebruik de `next-themes` library voor automatische SSR/hydration handling, localStorage persistence, en system preference detectie. De provider moet worden toegevoegd aan de root layout component om alle pagina's te omvatten.

**Technische details:**
- Package: `next-themes` (latest versie)
- Installatie via: `bun add next-themes`
- Configuratie: `attribute="class"` voor Tailwind CSS compatibiliteit
- Default theme: `system` (respecteert OS preference)

---

**FV1.2: Theme Toggle Component** [DONE]

Creëer een UI component waarmee gebruikers handmatig kunnen wisselen tussen light, dark, en system mode.

Het component moet de huidige theme tonen en gebruikers in staat stellen te switchen tussen de beschikbare opties. Component moet hydration-safe zijn door alleen client-side te renderen.

**Technische details:**
- Client component met `'use client'` directive
- Gebruik `useTheme()` hook van next-themes
- Mounted state check voor hydration mismatch preventie
- Opties: System, Light, Dark

---

**FV1.3: Theme Persistence** [DONE]

De geselecteerde theme moet persistent zijn tussen sessies en tabs.

Dit wordt automatisch afgehandeld door next-themes via localStorage. Wanneer een gebruiker een theme kiest, moet deze keuze behouden blijven bij het opnieuw laden van de pagina en gesynchroniseerd worden tussen meerdere tabs.

---

### FV2: Visuele Implementatie

---

**FV2.1: CSS Variables Configuratie** [DONE]

Gebruik de bestaande dark mode CSS variables die al gedefinieerd zijn in `globals.css`.

De `.dark` class (regel 81-113 in globals.css) bevat alle benodigde kleurvariabelen voor dark mode. Er is al een `@custom-variant dark` gedefinieerd die automatisch stijlen toepast wanneer de `.dark` class aanwezig is op een parent element.

**Technische details:**
- Geen aanpassingen nodig aan globals.css
- Dark mode kleuren zijn al gedefinieerd met oklch() kleurruimte
- Custom variant: `@custom-variant dark (&:is(.dark *))`

---

**FV2.2: Component Styling** [DONE]

Alle bestaande UI componenten moeten automatisch reageren op theme changes.

Omdat alle componenten Tailwind utility classes gebruiken en de dark variant al geconfigureerd is, zouden componenten automatisch moeten werken. Eventuele componenten die niet correct reageren moeten worden aangepast met dark: variants.

---

**FV2.3: Theme Toggle UI Integratie** [DONE]

Integreer de theme toggle functionaliteit met de avatar groep rechtsboven in de header.

Wanneer gebruikers klikken op de avatar area (PresenceAvatars component) in de rechterbovenhoek van de header, moet er een dropdown menu verschijnen met theme opties. Dit zorgt voor een toegankelijke en intuïtieve locatie voor theme switching zonder extra UI elementen toe te voegen aan de header.

**Technische details:**
- Locatie: `src/components/features/retrospective/board.tsx`, regel 85 (PresenceAvatars component)
- Implementatie: Dropdown Menu component met theme selector
- Avatar groep wordt clickable gemaakt met pointer cursor
- Hover toont nog steeds de individuele presence tooltips
- Click opent het theme dropdown menu
- Moet naadloos integreren met bestaande presence functionality

---

**FV2.4: Avatar Dropdown Menu** [DONE]

Creëer een dropdown menu dat wordt getoond bij klik op de avatar area.

Het menu moet theme opties tonen (Light, Dark, System) met een visuele indicator voor de huidige actieve theme. Het menu moet duidelijk onderscheidbaar zijn van de presence tooltips die al bestaan.

**Technische details:**
- Gebruik Radix UI DropdownMenu component (al beschikbaar in project)
- Menu items: Light, Dark, System
- Visual indicator voor actieve theme (checkmark of radio button)
- Click outside om te sluiten

---

## 3. Technische Overwegingen

---

**TO1: Next.js App Router Compatibiliteit** [DONE]

Zorg voor correcte integratie met Next.js 16 App Router architecture.

De ThemeProvider is een Client Component en moet worden gewrapped in de root layout. Het `<html>` element heeft `suppressHydrationWarning` nodig omdat next-themes de class attribute tijdens hydration modificeert.

**Implementatie:**
- Voeg ThemeProvider toe aan `src/app/layout.tsx`
- Wrap children in ThemeProvider
- Voeg `suppressHydrationWarning` toe aan `<html>` tag

---

**TO2: Hydration Mismatch Prevention** [DONE]

Voorkom hydration mismatches bij theme-afhankelijke UI componenten.

Theme state is undefined tijdens server-side rendering. Componenten die de huidige theme tonen moeten alleen client-side renderen door een mounted state check te gebruiken.

**Pattern:**
```typescript
const [mounted, setMounted] = useState(false)
useEffect(() => setMounted(true), [])
if (!mounted) return null
```

---

**TO3: Tailwind CSS v4 Compatibiliteit** [DONE]

Gebruik de custom variant syntax die compatibel is met Tailwind CSS v4.

De bestaande `@custom-variant dark` configuratie is correct voor Tailwind v4. Componenten kunnen de `dark:` prefix gebruiken in className attributen.

---

**TO4: Performance & Bundle Size** [DONE]

Minimaliseer impact op bundle size en performance.

next-themes is een lightweight library (~2.5kb gzipped). Theme switching gebeurt direct op de DOM en vereist geen re-render van de hele applicatie, wat zorgt voor instant feedback.

---

**TO5: System Preference Detection** [DONE]

Respecteer operating system theme preference als default.

next-themes detecteert automatisch `prefers-color-scheme` media query. Bij eerste bezoek wordt de system preference gebruikt tenzij de gebruiker expliciet een theme kiest.

---

**TO6: PresenceAvatars Component Modificatie** [DONE]

Integreer theme toggle functionaliteit zonder de bestaande presence feature te verstoren.

**Gekozen implementatie aanpak: Optie C - Clickable Avatar Groep**

Maak de avatar groep zelf clickable met een dropdown menu voor theme switching. De PresenceAvatars component wordt uitgebreid met click-to-open functionaliteit die een dropdown menu toont met theme opties.

**Implementatie details:**
- Wrap de PresenceAvatars container in een DropdownMenu trigger
- Presence tooltips blijven werken op hover (hover state)
- Click op de avatar area opent het theme dropdown menu (click state)
- Dropdown menu positioneert rechts uitgelijnd onder de avatars
- Z-index: tooltips (hover) < dropdown menu (click)
- Gebruik pointer cursor op hover om clickability aan te geven

**Voordelen van deze aanpak:**
- Minimale UI veranderingen, geen extra iconen nodig
- Logische integratie: user settings bij user avatars
- Behoud van schone, minimalistische header layout

---

## 4. Buiten Scope (voor deze versie)

* **Custom Theme Colors:** Alleen light en dark mode, geen custom kleurenschema's of meerdere theme varianten
* **Per-Component Theme Overrides:** Geen mogelijkheid om specifieke componenten een ander theme te geven dan de globale instelling
* **Scheduled Theme Switching:** Geen automatische switching op basis van tijd (bijv. dark mode na zonsondergang)
* **Theme Preview:** Geen live preview van themes voordat ze worden toegepast
* **Animated Transitions:** Geen fade/transition animaties tussen theme switches (instant switch)
* **Per-Page Theme Settings:** Theme is globaal voor de hele applicatie, niet per pagina instelbaar
* **Accessibility Settings Integration:** Geen integratie met andere accessibility instellingen zoals contrast verhogen of reduced motion
* **Theme Customization UI:** Geen interface om kleuren aan te passen binnen light/dark themes

## 5. Succescriteria

* **SC1: Functionele Theme Switching**
  - Gebruikers kunnen wisselen tussen light, dark, en system mode door te klikken op de avatar area rechtsboven in de header
  - Het dropdown menu opent correct en toont alle drie de theme opties
  - De huidige actieve theme is visueel gemarkeerd in het menu
  - De gekozen theme wordt correct toegepast op alle UI componenten
  - Theme keuze persists tussen page refreshes en browser sessies

* **SC2: System Preference Support**
  - Bij eerste bezoek wordt automatisch de OS theme preference gedetecteerd en toegepast
  - Wanneer "System" mode is geselecteerd, volgt de applicatie automatisch OS theme changes

* **SC3: Visuele Consistentie**
  - Alle UI componenten (buttons, cards, dialogs, inputs, etc.) tonen correcte kleuren in beide themes
  - Geen broken styling of onleesbare tekst in dark mode
  - Voldoende contrast ratios voor toegankelijkheid (WCAG AA standaard)

* **SC4: Technische Kwaliteit**
  - Geen hydration warnings in de browser console
  - Geen flashing/flickering bij page load (FOUC - Flash of Unstyled Content)
  - Theme switching voelt instant aan (<100ms visuele update)

* **SC5: Cross-Tab Synchronisatie**
  - Theme changes worden automatisch gesynchroniseerd tussen meerdere tabs/windows
  - Geen inconsistente state tussen verschillende browser tabs

* **SC6: Bundle Impact**
  - Total bundle size increase van maximaal 5kb (gzipped)
  - Geen negatieve impact op First Contentful Paint (FCP) metrics

* **SC7: Integratie met Bestaande Features**
  - PresenceAvatars functionaliteit blijft volledig functioneel (tooltips, online indicators, etc.)
  - Geen visuele conflicten tussen presence tooltips en theme dropdown menu
  - Theme toggle is duidelijk onderscheidbaar maar voelt geïntegreerd in de bestaande UI
